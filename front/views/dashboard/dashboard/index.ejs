<!--main content start-->
<section id="main-content">
    <section id="dashboard" class="wrapper">
        <!-- page start -->
        <div class="row">
            <div class="col-md-12">
                <!--breadcrumbs start -->
                <ul class="breadcrumb">
                    <li><a href="/projects"><i class="fa fa-home"></i> Home</a></li>
                    <li><a id="load_title" href="#"><i id="load_icon" class="fa fa-refresh fa-spin"></i></a></li>
                    <li class="active">Dashboard</li>
                </ul>
                <!--breadcrumbs end -->
            </div>
        </div>

        <div>
            <!--mini statistics start-->
            <div class="row">
                <div class="col-md-3 col-sm-6">
                    <div class="mini-stat clearfix">
                        <span class="mini-stat-icon orange"><i class="fa fa-bug"></i></span>
                        <div class="mini-stat-info">
                            <div id="load_crash">
                            </div>
                            Weekly Crashes
                        </div>
                    </div>
                </div>
                <div class="col-md-3 col-sm-6">
                    <div class="mini-stat clearfix">
                        <span class="mini-stat-icon tar"><i class="fa fa-users"></i></span>
                        <div class="mini-stat-info">
                            <div id="load_user">
                            </div>
                            Weekly Active Users
                        </div>
                    </div>
                </div>
                <div class="col-md-3 col-sm-6">
                    <div class="mini-stat clearfix">
                        <span class="mini-stat-icon pink"><i class="fa fa-bar-chart-o"></i></span>
                        <div class="mini-stat-info">
                            <div id="load_rate">
                            </div>
                            Avg Bug Rate
                        </div>
                    </div>
                </div>
                <div class="col-md-3 col-sm-6">
                    <div class="mini-stat clearfix">
                        <span class="mini-stat-icon green"><i class="fa fa-code-fork"></i></span>
                        <div class="mini-stat-info">
                            <div id="load_sdk">
                            </div>
                            Problematic SDK
                        </div>
                    </div>
                </div>
            </div>
            <!--mini statistics end-->
        </div>
        <div class="row">
            <div class="col-lg-8 col-sm-6">
                <section class="panel">
                    <div class="panel-body">
                        <div class="top-stats-panel">
                            <div class="daily-visit">
                                <h4 class="widget-h">Daily Errors</h4>
                                <div id="daily-visit-chart" style="width:100%; height: 150px; display: block">
                                </div>
                            </div>
                        </div>
                    </div>
                </section>
            </div>
            <div class="col-lg-4 col-sm-6">
                <section class="panel">
                    <div class="panel-body">
                        <div class="top-stats-panel">
                            <h4 class="widget-h">Rank Rating</h4>
                            <div class="sm-pie" style="height:150px">
                            </div>
                        </div>
                    </div>
                </section>
            </div>
        </div>

        <div class="row">
            <div class="col-sm-12">
                <section class="panel">
                    <header class="panel-heading">
                        Error Table
                        <span class="tools pull-right">
                            <a href="javascript:;" class="fa fa-chevron-down"></a>
                            <!-- <a href="javascript:;" class="fa fa-times"></a> -->
                         </span>
                    </header>
                    <div class="panel-body">
                        <div>
                            <div class="btn-row">
                                <div class="btn-group" data-toggle="buttons">
                                    <label class="btn btn-info active tooltips" id="btnTranding">
                                        <input type="radio" name="options"><i class="fa fa-exclamation-triangle"></i> Tranding
                                    </label>
                                    <label class="btn btn-info tooltips" id="btnLatest">
                                        <input type="radio" name="options"><i class="fa fa-refresh"></i> Latest
                                    </label>
                                </div>
                            </div>
                        </div>
                        <div id="errors-table" class="adv-table">
                            <table class="table table-hover table-striped" id="dynamic-table">
                                <thead>
                                <tr>
                                    <th style="width:50px">Rank</th>
                                    <th style="width:60px">Count</th>
                                    <th>Name</th>
                                    <th style="width:180px">Tags</th>
                                    <th style="width:60px" class="res-hidden">Date</th>
                                </tr>
                                </thead>
                                <tbody>
                                <tr>
                                    <td data-title="Rank" class="text-center"></td>
                                    <td data-title="Count" class="text-center text-danger text-bold"></td>
                                    <td data-title="Name" class="table-text-ellipsis"></td>
                                    <td data-title="Tags" class="tags"></td>
                                    <td data-title="Date" class="res-hidden"></td>
                                </tr>
                                </tbody>
                            </table>
                        </div>
                    </div>
                </section>
            </div>
        </div>
    </section>
</section>

<% include scripts %>

<script id="textDataTmpl" type="text/x-jsrender">
    <span>{{:data}}</span>
</script>
<script id="plainDataTmpl" type="text/x-jsrender">
{{:data}}
</script>
<script>
    var template = $.templates("#textDataTmpl");
    var plainTemplate = $.templates("#plainDataTmpl");
    var b, s = -1;
    var err = false;
    $.ajax({
        url:'/api/project/<%= data.id %>/weekly/error',
        success:function(data){
            var htmlOutput = template.render(data);
            $("#load_crash").html(htmlOutput);
            b = data.data;
            updateRate();
        },
        error: function(jqXHR, textStatus, errorThrown) {
            var data = {data:'<i class="fa fa-exclamation-triangle"></i>'};
            var htmlOutput = template.render(data);
            $("#load_crash").html(htmlOutput);
            err = true;
        }
    });
    $.ajax({
        url:'/api/project/<%= data.id %>/weekly/session',
        success:function(data){
            var htmlOutput = template.render(data);
            $("#load_user").html(htmlOutput);
            s = data.data;
            updateRate();
        },
        error: function(jqXHR, textStatus, errorThrown) {
            var data = {data:'<i class="fa fa-exclamation-triangle"></i>'};
            var htmlOutput = template.render(data);
            $("#load_user").html(htmlOutput);
            updateRate();
            err = true;
        }
    });
    $.ajax({
        url:'/api/project/<%= data.id %>/sdk',
        success:function(data){
            var htmlOutput = template.render(data);
            $("#load_sdk").html(htmlOutput);
            updateRate();
        },
        error: function(jqXHR, textStatus, errorThrown) {
            var data = {data:'<i class="fa fa-exclamation-triangle"></i>'};
            var htmlOutput = template.render(data);
            $("#load_sdk").html(htmlOutput);
            updateRate();
            err = true;
        }
    });
    $.ajax({
        url:'/api/project/<%= data.id %>',
        success:function(data){
            console.log(JSON.parse(data).title);
            var htmlOutput = plainTemplate.render({data:JSON.parse(data).title});
            $("#load_title").html(htmlOutput);
        },
        error: function(jqXHR, textStatus, errorThrown) {
            var data = {data:'<i class="fa fa-exclamation-triangle"></i>'};
            var htmlOutput = plainTemplate.render(data);
            $("#load_title").html(htmlOutput);
        }
    });
    function updateRate(){
        if(err == true){
            var data = {data:'<i class="fa fa-exclamation-triangle"></i>'};
            var htmlOutput = template.render(data);
            $("#load_rate").html(htmlOutput);
        }
        else if(b != -1 && s != -1 && err != true){
            if(s == 0){
                s=1;
            }
            var percent = (b/s*100).toFixed(1);
            var data = {data:percent+"%"};
            var htmlOutput = template.render(data);
            $("#load_rate").html(htmlOutput);
        }
    }
</script>